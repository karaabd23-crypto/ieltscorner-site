---
import Layout from "../../../layouts/Layout.astro";
import { getCollection, type CollectionEntry } from "astro:content";

type LessonEntry = CollectionEntry<"lessons">;

const lessons = (
  await getCollection(
    "lessons",
    ({ data }: { data: LessonEntry["data"] }) => !data.draft && data.category === "grammar"
  )
).sort((a: LessonEntry, b: LessonEntry) => (a.data.date < b.data.date ? 1 : -1));
---

<Layout
  title="Grammar Lessons â€” IELTS & CELPIP | IELTS Corner"
  description="High-precision grammar lessons for IELTS & CELPIP candidates aiming for Band 7+ and CLB 9+. Focus on meaning, use, and scoring impact."
>
  <!-- HERO -->
  <section class="section">
    <div class="stack">
      <span class="pill">ðŸ§© Grammar â€¢ C1 / Band 7+ Focus</span>

      <h1>Grammar lessons that actually change scores.</h1>

      <p class="muted" style="max-width: 70ch;">
        These lessons focus on meaning, use, and control â€” not rule memorization. Youâ€™ll learn how advanced grammar
        functions in real exam responses, especially in <strong>Writing</strong> and <strong>Speaking</strong>.
      </p>

      <div class="cluster">
        <a class="btn btn-primary" href="/celpip">Use grammar for CELPIP â†’</a>
        <a class="btn" href="/ielts">IELTS strategy â†’</a>
      </div>
    </div>
  </section>

  <!-- AVAILABLE LESSONS -->
  <section class="section-sm">
    <div class="stack">
      <h2>Available lessons</h2>

      <div class="grid grid-2" style="margin-top: var(--s-5);">
        {lessons.map((l: LessonEntry) => (
          <a class="card" href={`/lessons/${l.data.category}/${l.slug}/`} style="display:block;">
            <div class="cluster" style="justify-content: space-between;">
              <div class="cluster">
                <span class="pill">{l.data.level} â€¢ {l.data.exam.join(" & ")}</span>
                {l.data.tags?.length ? <span class="pill">{l.data.tags[0]}</span> : null}
              </div>
              <span class="pill">Open â†’</span>
            </div>

            <h3 style="margin-top: var(--s-3);">{l.data.title}</h3>
            <p class="muted" style="margin-bottom: 0;">
              {l.data.excerpt}
            </p>
          </a>
        ))}
      </div>

      {lessons.length === 0 ? (
        <div class="surface" style="padding: var(--s-6); margin-top: var(--s-5);">
          <p class="muted" style="margin:0;">
            No grammar lessons are published yet. Check back soon.
          </p>
        </div>
      ) : null}
    </div>
  </section>

  <!-- HOW TO USE -->
  <section class="section-sm">
    <div class="surface" style="padding: var(--s-6);">
      <div class="grid grid-2">
        <div class="stack">
          <h2>How to use these grammar lessons</h2>
          <p class="muted" style="max-width: 70ch;">
            Advanced grammar only helps if itâ€™s controlled. These lessons are designed to be used slowly and applied
            directly to exam tasks.
          </p>
        </div>

        <div class="grid" style="gap: var(--s-3);">
          <div class="card" style="padding: var(--s-4); box-shadow: none;">
            <strong>1) Study the function</strong>
            <div class="muted">Focus on meaning and context, not form alone.</div>
          </div>
          <div class="card" style="padding: var(--s-4); box-shadow: none;">
            <strong>2) Apply to a task</strong>
            <div class="muted">Use it in a sentence or response youâ€™d actually write or say.</div>
          </div>
          <div class="card" style="padding: var(--s-4); box-shadow: none;">
            <strong>3) Limit usage</strong>
            <div class="muted">One or two controlled uses beat overuse every time.</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- WHAT'S COMING -->
  <section class="section-sm">
    <div class="stack">
      <h2>Coming next</h2>
      <p class="muted" style="max-width: 70ch;">
        Future grammar lessons will target structures that consistently affect coherence, tone, and examiner judgment.
      </p>

      <div class="grid grid-3" style="margin-top: var(--s-5);">
        <div class="card" style="box-shadow:none;">
          <h3>Conditionals &amp; hypothetical framing</h3>
          <p class="muted">Precision in argumentation and evaluation.</p>
        </div>
        <div class="card" style="box-shadow:none;">
          <h3>Aspect &amp; time reference</h3>
          <p class="muted">Narrative control and clarity in writing tasks.</p>
        </div>
        <div class="card" style="box-shadow:none;">
          <h3>Clause packaging</h3>
          <p class="muted">Density without losing readability.</p>
        </div>
      </div>
    </div>
  </section>
</Layout>
